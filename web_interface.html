<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFID 打卡系統控制面板</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
        }
        
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background-color: #fafafa;
        }
        
        .btn {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .btn-read {
            background-color: #2196F3;
        }
        
        .btn-write {
            background-color: #FF9800;
        }
        
        .btn-mode {
            background-color: #9E9E9E;
        }
        
        .btn:hover {
            opacity: 0.8;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            background-color: #e7f3ff;
            border-left: 6px solid #2196F3;
        }
        
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            background-color: #f0f8e0;
            border-left: 6px solid #4CAF50;
        }
        
        .error {
            background-color: #ffebee;
            border-left: 6px solid #f44336;
        }
        
        .connection-status {
            float: right;
            padding: 5px 10px;
            border-radius: 4px;
            color: white;
        }
        
        .connected {
            background-color: #4CAF50;
        }
        
        .disconnected {
            background-color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>RFID 打卡系統控制面板</h1>
        
        <div id="connectionStatus" class="connection-status disconnected">未連接</div>
        
        <div class="card">
            <h3>模式控制</h3>
            <button class="btn btn-mode" onclick="switchMode('READ')">設定為讀取模式</button>
            <button class="btn btn-mode" onclick="switchMode('WRITE')">設定為寫入模式</button>
        </div>
        
        <div class="card">
            <h3>讀取卡片</h3>
            <button class="btn btn-read" onclick="readCard()">讀取卡片資料</button>
            <div id="readResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="card">
            <h3>寫入卡片</h3>
            <label for="writeData">要寫入的資料:</label>
            <input type="text" id="writeData" placeholder="例如: 00100" maxlength="16">
            <br><br>
            <button class="btn btn-write" onclick="writeCard()">寫入卡片</button>
            <div id="writeResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="card">
            <h3>狀態資訊</h3>
            <div id="statusInfo" class="status">
                請先建立與Arduino的串口連接
            </div>
        </div>
        
        <div class="card">
            <h3>說明</h3>
            <ul>
                <li>點擊"讀取卡片"按鈕後，將RFID卡片靠近讀取器</li>
                <li>在"要寫入的資料"欄位輸入要寫入的資料，然後點擊"寫入卡片"</li>
                <li>卡片資料將會寫入到第4區塊</li>
                <li>支援最多16字元的資料寫入</li>
            </ul>
        </div>
    </div>

    <script>
        // 模擬串口通信（實際應用中需要配合後端服務）
        let isConnected = false;
        
        // 連接狀態檢查
        function checkConnection() {
            // 這是一個模擬，實際應用中需要實現真正的串口通信
            const connectionStatus = document.getElementById('connectionStatus');
            const statusInfo = document.getElementById('statusInfo');
            
            if (isConnected) {
                connectionStatus.className = 'connection-status connected';
                connectionStatus.textContent = '已連接';
                statusInfo.innerHTML = '已連接到Arduino RFID系統<br>可以進行讀寫操作';
            } else {
                connectionStatus.className = 'connection-status disconnected';
                connectionStatus.textContent = '未連接';
                statusInfo.innerHTML = '請先建立與Arduino的串口連接<br>可能需要安裝串口通信插件或服務';
            }
        }
        
        // 模擬連接Arduino
        function connectArduino() {
            // 在真實實現中，這裡會建立WebSocket或串口連接
            isConnected = true;
            checkConnection();
        }
        
        // 切換模式
        function switchMode(mode) {
            if (!isConnected) {
                alert('請先連接Arduino設備！');
                return;
            }
            
            const command = `MODE:${mode}`;
            sendCommand(command);
        }
        
        // 讀取卡片
        function readCard() {
            if (!isConnected) {
                alert('請先連接Arduino設備！');
                return;
            }
            
            const command = 'READ';
            sendCommand(command);
        }
        
        // 寫入卡片
        function writeCard() {
            if (!isConnected) {
                alert('請先連接Arduino設備！');
                return;
            }
            
            const data = document.getElementById('writeData').value;
            if (!data) {
                alert('請輸入要寫入的資料！');
                return;
            }
            
            if (data.length > 16) {
                alert('資料長度不能超過16個字元！');
                return;
            }
            
            const command = `WRITE:${data}`;
            sendCommand(command);
        }
        
        // 發送命令到Arduino
        function sendCommand(command) {
            // 顯示狀態
            const statusInfo = document.getElementById('statusInfo');
            statusInfo.innerHTML = `發送命令: ${command}<br>等待Arduino響應...`;
            
            // 模擬發送命令到Arduino
            // 在真實實現中，這裡會通過串口或WebSocket發送命令
            console.log(`發送命令到Arduino: ${command}`);
            
            // 模擬響應
            setTimeout(() => {
                if (command.startsWith('WRITE:')) {
                    const data = command.substring(6);
                    document.getElementById('writeResult').innerHTML = `成功寫入資料: ${data}`;
                    document.getElementById('writeResult').style.display = 'block';
                    document.getElementById('readResult').style.display = 'none';
                } else if (command === 'READ') {
                    // 模擬讀取結果
                    const mockUid = '16:CB:EE:B3';
                    const mockData = '00100';
                    document.getElementById('readResult').innerHTML = `卡片UID: ${mockUid}<br>卡片資料: ${mockData}`;
                    document.getElementById('readResult').style.display = 'block';
                    document.getElementById('writeResult').style.display = 'none';
                } else if (command.startsWith('MODE:')) {
                    const mode = command.split(':')[1];
                    statusInfo.innerHTML = `已切換到${mode === 'READ' ? '讀取' : '寫入'}模式`;
                }
                
                // 模擬完成狀態
                statusInfo.innerHTML = `命令 "${command}" 已執行完成`;
            }, 1000);
        }
        
        // 初始化
        window.onload = function() {
            // 模擬連接
            setTimeout(connectArduino, 1000);
        };
    </script>
</body>
</html>